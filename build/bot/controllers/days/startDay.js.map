{"version":3,"sources":["../../../../src/bot/controllers/days/startDay.js"],"names":[],"mappings":"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","file":"startDay.js","sourcesContent":["import os from 'os';\nimport { wit } from '../index';\nimport http from 'http';\nimport bodyParser from 'body-parser';\n\nimport models from '../../../app/models';\n\nimport { randomInt } from '../../lib/botResponses';\nimport { convertResponseObjectsToTaskArray, convertArrayToTaskListMessage, convertTimeStringToMinutes } from '../../lib/messageHelpers';\nimport intentConfig from '../../lib/intents';\n\nexport const FINISH_WORD = 'done';\nexport const EXIT_EARLY_WORDS = ['exit', 'stop','never mind','quit'];\n\n// base controller for start day\nexport default function(controller) {\n\n\t// programmatic trigger of actual day start flow: `begin_day_flow`\n\tcontroller.on('trigger_day_start', (bot, config) => {\n\n\t\tconst { SlackUserId } = config;\n\t\tcontroller.trigger(`user_confirm_new_day`, [ bot, { SlackUserId } ]);\n\n\t})\n\n\t/**\n\t * \t\tUser directly asks to start day\n\t * \t\t\t\t~* via Wit *~\n\t * \t\t\tconfirm for `begin_day_flow`\n\t */\n\tcontroller.hears(['start_day'], 'direct_message', wit.hears, (bot, message) => {\n\n\t\tconst SlackUserId = message.user;\n\n\t\tbot.send({\n\t\t\ttype: \"typing\",\n\t\t\tchannel: message.channel\n\t\t});\n\t\tsetTimeout(()=>{\n\t\t\tmodels.User.find({\n\t\t\twhere: [`\"SlackUser\".\"SlackUserId\" = ?`, SlackUserId ],\n\t\t\t\tinclude: [\n\t\t\t\t\tmodels.SlackUser\n\t\t\t\t]\n\t\t\t})\n\t\t\t.then((user) => {\n\t\t\t\tcontroller.trigger(`user_confirm_new_day`, [ bot, { SlackUserId }]);\n\n\t\t\t\tbot.startPrivateConversation({ user: SlackUserId }, (err, convo) => {\n\t\t\t\t\tconvo.config = { SlackUserId };\n\t\t\t\t\tvar name = user.nickName || user.email;\n\t\t\t\t\tconvo.say(`Hey, ${name}!`);\n\t\t\t\t\tconvo.on('end', (convo) => {\n\t\t\t\t\t\tconsole.log(convo);\n\t\t\t\t\t\tconst { SlackUserId } = convo.config;\n\t\t\t\t\t\t\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t})\n\t\t}, 1000);\n\t});\n\n\t/**\n\t * \t\t\tUser confirms he is wanting to\n\t * \t\t\t\t\tstart his day. confirmation\n\t * \t\t\t\tneeded every time b/c this resets everything\n\t */\n\n\tcontroller.on('user_confirm_new_day', (bot, config) => {\n\n\t\tconst { SlackUserId } = config;\n\n\t\tmodels.User.find({\n\t\t\twhere: [`\"SlackUser\".\"SlackUserId\" = ?`, SlackUserId ],\n\t\t\tinclude: [\n\t\t\t\tmodels.SlackUser\n\t\t\t]\n\t\t})\n\t\t.then((user) => {\n\n\t\t\tbot.startPrivateConversation({ user: SlackUserId }, (err, convo) => {\n\n\t\t\t\tvar name              = user.nickName || user.email;\n\t\t\t\tconvo.name            = name;\n\t\t\t\tconvo.readyToStartDay = false;\n\n\t\t\t\tconvo.ask(`Would you like to start your day?`, [\n\t\t\t\t\t{\n\t\t\t\t\t\tpattern: bot.utterances.yes,\n\t\t\t\t\t\tcallback: (response, convo) => {\n\t\t\t\t\t\t\tconvo.say(\"Let's do it! :car: :dash:\");\n\t\t\t\t\t\t\tconvo.readyToStartDay = true;\n\t\t\t\t\t\t\tconvo.next();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tpattern: bot.utterances.no,\n\t\t\t\t\t\tcallback: (response, convo) => {\n\t\t\t\t\t\t\tconvo.say(\"Okay. Let me know whenever you're ready to start your day :wave:\");\n\t\t\t\t\t\t\tconvo.next();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tdefault: true,\n\t\t\t\t\t\tcallback: (response, convo) => {\n\t\t\t\t\t\t\tconvo.say(\"Couldn't quite catch that. Let me know whenever you're ready to `start your day` :wave:\");\n\t\t\t\t\t\t\tconvo.next();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t\tconvo.on('end', (convo) => {\n\t\t\t\t\tif (convo.readyToStartDay) {\n\t\t\t\t\t\tcontroller.trigger(`begin_day_flow`, [ bot, { SlackUserId }]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\n\t\t\t});\n\t\t});\n\n\t})\n\n\t/**\n\t* \t~ ACTUAL START OF YOUR DAY ~\n\t* \t\t* ask for today's tasks\n\t* \t\t* prioritize tasks\n\t* \t\t* set time to tasks\n\t* \t\t* enter work session flow\n\t* \t\t\n\t*/\n\tcontroller.on('begin_day_flow', (bot, config) => {\n\n\t\tconst { SlackUserId } = config;\n\n\t\tmodels.User.find({\n\t\t\twhere: [`\"SlackUser\".\"SlackUserId\" = ?`, SlackUserId ],\n\t\t\tinclude: [\n\t\t\t\tmodels.SlackUser\n\t\t\t]\n\t\t})\n\t\t.then((user) => {\n\n\t\t\tbot.startPrivateConversation({ user: SlackUserId }, (err, convo) => {\n\n\t\t\t\tvar name   = user.nickName || user.email;\n\t\t\t\tconvo.name = name;\n\n\t\t\t\tconvo.dayStart = {\n\t\t\t\t\tUserId: user.id,\n\t\t\t\t\tstartDayDecision: false // what does user want to do with day\n\t\t\t\t}\n\n\t\t\t\t// start the flow\n    \t\taskForDayTasks(err, convo);\n\n    \t\t// on finish conversation\n    \t\tconvo.on('end', (convo) => {\n\n  \t\t\t\tvar responses = convo.extractResponses();\n  \t\t\t\tconst { dayStart } = convo;\n\n  \t\t\t\tconsole.log('done!')\n  \t\t\t\tconsole.log(\"here is day start object:\\n\\n\\n\");\n  \t\t\t\tconsole.log(convo.dayStart);\n  \t\t\t\tconsole.log(\"\\n\\n\\n\");\n\n    \t\t\tif (convo.status == 'completed') {\n\n    \t\t\t\tconst { UserId, prioritizedTaskArray } = dayStart;\n\n    \t\t\t\t// log `start_work` in SessionGroups\n    \t\t\t\t// and all other relevant DB inserts\n    \t\t\t\tmodels.SessionGroup.create({\n    \t\t\t\t\ttype: \"start_work\",\n    \t\t\t\t\tUserId\n    \t\t\t\t})\n    \t\t\t\t.then((sessionGroup) => {\n\n    \t\t\t\t\t// make all pending tasks => archived, then all live tasks => pending\n\t    \t\t\t\t// BEFORE the newly created start SessionGroup\n\t    \t\t\t\tuser.getDailyTasks({\n\t    \t\t\t\t\twhere: [`\"DailyTask\".\"createdAt\" < ? AND \"DailyTask\".\"type\" = ?`, sessionGroup.createdAt, \"pending\"]\n\t    \t\t\t\t})\n\t    \t\t\t\t.then((dailyTasks) => {\n\t    \t\t\t\t\tdailyTasks.forEach((dailyTask) => {\n\t\t\t\t\t        dailyTask.update({\n\t\t\t\t\t          type: \"archived\"\n\t\t\t\t\t        });\n\t\t\t\t\t      });\n\t\t\t\t\t      user.getDailyTasks({\n\t\t    \t\t\t\t\twhere: [`\"DailyTask\".\"createdAt\" < ? AND \"DailyTask\".\"type\" = ?`, sessionGroup.createdAt, \"live\"]\n\t\t    \t\t\t\t})\n\t\t    \t\t\t\t.then((dailyTasks) => {\n\n\t\t    \t\t\t\t\tdailyTasks.forEach((dailyTask) => {\n\t\t\t\t\t\t        dailyTask.update({\n\t\t\t\t\t\t          type: \"pending\"\n\t\t\t\t\t\t        });\n\t\t\t\t\t\t      });\n\n\t\t\t\t\t\t      // After all of the previous tasks have been put into \"pending\", choose the select ones and bring them back to \"live\"\n\t\t\t    \t\t\t\tprioritizedTaskArray.forEach((task, index) => {\n\t\t\t    \t\t\t\t\tconst { text, minutes} = task;\n\t\t\t    \t\t\t\t\tvar priority = index + 1;\n\t\t\t    \t\t\t\t\tmodels.Task.create({\n\t\t\t\t\t\t\t\t\t    text\n\t\t\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t\t\t  .then((task) => {\n\t\t\t\t\t\t\t\t\t    models.DailyTask.create({\n\t\t\t\t\t\t\t\t\t      TaskId: task.id,\n\t\t\t\t\t\t\t\t\t      priority,\n\t\t\t\t\t\t\t\t\t      minutes,\n\t\t\t\t\t\t\t\t\t      UserId\n\t\t\t\t\t\t\t\t\t    });\n\t\t\t\t\t\t\t\t\t    // THIS IS WHERE YOU WILL UPDATE THE PREVIOUS DAY'S PENDING TASKS\n\t\t\t\t\t\t\t\t\t  });\n\t\t\t    \t\t\t\t});\n\n\t\t    \t\t\t\t});\n\t    \t\t\t\t});\n\n\t    \t\t\t});\n\n    \t\t\t\t// TRIGGER SESSION_START HERE\n    \t\t\t\tif (dayStart.startDayDecision == intentConfig.START_SESSION) {\n    \t\t\t\t\tcontroller.trigger(`confirm_new_session`, [ bot, { SlackUserId }]);\n    \t\t\t\t\treturn;\n    \t\t\t\t}\n\n    \t\t\t} else {\n    \t\t\t\t// default premature end\n\t\t\t\t\t\tbot.startPrivateConversation({ user: SlackUserId }, (err, convo) => {\n\t\t\t\t\t\t\tconvo.say(\"Okay! Exiting now. Let me know when you want to start your day!\");\n\t\t\t\t\t\t\tconvo.next();\n\t\t\t\t\t\t});\n    \t\t\t}\n    \t\t});\n\n\t\t\t});\n\n\t\t})\n\n\t});\n\n};\n\n// user just started conersation and is entering tasks\nfunction askForDayTasks(response, convo){\n\n\tconst { task }                = convo;\n\tconst { bot, source_message } = task;\n\n\tconsole.log(\"in ask for day tasks\");;\n\tconsole.log(convo.name);\n\n\tconvo.say(`What tasks would you like to work on today? :pencil: You can enter everything in one line separated by commas, or send me each task in a separate line`);\n\tconvo.ask(`Then just tell me when you're done by saying \\`${FINISH_WORD}\\``, (response, convo) => {\n\n\t\tfor (var i = 0; i < EXIT_EARLY_WORDS.length; i++) {\n\t\t\tconsole.log(`in exit early words loop! ${EXIT_EARLY_WORDS[i]}`);\n\t\t\tif (response.text == EXIT_EARLY_WORDS[i])\n\t\t\t\tconvo.stop();\n\t\t}\n\n\t\tconsole.log(`response is`);\n\t\tconsole.log(response);\n\t\tif (response.text == FINISH_WORD) {\n\t\t\tconvo.say(\"Awesome! You can always add more tasks later by telling me, `I'd like to add a task` or something along those lines :grinning:\");\n\t\t\tdisplayTaskList(response, convo);\n\t\t\tconvo.next();\n\t\t}\n\t}, { 'key' : 'tasks', 'multiple': true});\n\n}\n\n// user has just entered his tasks for us to display back\nfunction displayTaskList(response, convo) {\n\n\tconst { task }                = convo;\n\tconst { bot, source_message } = task;\n\n\tvar { tasks } = convo.responses;\n\n\tvar tasks = convo.responses.tasks;\n\tvar taskArray = convertResponseObjectsToTaskArray(tasks);\n\n\t// taskArray is now attached to convo\n\tconvo.dayStart.taskArray = taskArray;\n\n\tconsole.log(\"TASKS:\")\n\tconsole.log(taskArray);\n\n\tvar taskListMessage = convertArrayToTaskListMessage(taskArray);\n\n\t// we need to prioritize the task list here to display to user\n\tconvo.say(`Now, please rank your tasks in order of your priorities today`);\n\tconvo.say(taskListMessage);\n\tconvo.ask(`You can just list the numbers, like \\`3, 4, 1, 2, 5\\``, (response, convo) => {\n\t\tprioritizeTaskList(response, convo);\n\t\tconvo.next();\n\t}, { 'key' : 'taskPriorities' });\n\t\n}\n\n// user has listed `5, 4, 2, 1, 3` for priorities to handle here\nfunction prioritizeTaskList(response, convo) {\n\n\tconst { task }                = convo;\n\tconst { bot, source_message } = task;\n\n\t// organize the task list!\n\tvar { taskArray } = convo.dayStart;\n\n\t// get user priority order (`1,4,3,2`), convert it to an array of ints, and use that to prioritize your array\n\tvar initialPriorityOrder = response.text;\n\t\n\t// either a non-number, or number > length of tasks\n\tvar isInvalid = false;\n\tvar nonNumberTest = new RegExp(/\\D/);\n\tinitialPriorityOrder = initialPriorityOrder.split(\",\").map((order) => {\n\t\torder = order.trim();\n\t\tvar orderNumber = parseInt(order);\n\t\tif (nonNumberTest.test(order) || orderNumber > taskArray.length)\n\t\t\tisInvalid = true;\n\t\treturn orderNumber;\n\t});\n\n\tif (isInvalid) {\n\t\tconvo.say(\"Oops, looks like you didn't put in valid numbers :thinking_face:. Let's try this again\");\n\t\tdisplayTaskList(response, convo);\n\t\treturn;\n\t}\n\n\tvar priorityOrder = [];\n\tinitialPriorityOrder.forEach(function(order) {\n\t\tif ( order > 0) {\n\t\t\torder--; // make user-entered numbers 0-index based\n\t\t\tpriorityOrder.push(order);\n\t\t}\n\t});\n\n\tvar prioritizedTaskArray = [];\n\tpriorityOrder.forEach((order) => {\n\t\tprioritizedTaskArray.push(taskArray[order]);\n\t})\n\n\tconvo.dayStart.prioritizedTaskArray = prioritizedTaskArray;\n\n\tvar taskListMessage = convertArrayToTaskListMessage(prioritizedTaskArray);\n\n\tconvo.say(\"Is this the right priority?\");\n\tconvo.ask(taskListMessage, [\n\t\t{\n\t\t\tpattern: bot.utterances.yes,\n\t\t\tcallback: (response, convo) => {\n\t\t\t\tconvo.say(\"Excellent! Last thing: how much time would you like to allocate to each task today?\");\n\t\t\t\tconvo.say(taskListMessage);\n\t\t\t\tgetTimeToTasks(response, convo);\n\t\t\t\tconvo.next();\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tpattern: bot.utterances.no,\n\t\t\tcallback: (response, convo) => {\n\n\t\t\t\tconvo.say(\"Whoops :banana: Let's try to do this again\");\n\t\t\t\tdisplayTaskList(response, convo);\n\t\t\t\tconvo.next();\n\n\t\t\t}\n\t\t}\n\t], { 'key' : 'confirmedRightPriority' });\n\n}\n\n// ask the question to get time to tasks\nfunction getTimeToTasks(response, convo) {\n\tconvo.ask(`Just say, \\`30, 40, 1 hour, 1hr 10 min, 15m\\` in order and I'll figure it out and assign those times to the tasks above :smiley:`, (response, convo) => {\n\t\tassignTimeToTasks(response, convo);\n\t\tconvo.next();\n\t}, { 'key' : 'timeToTasksResponse' });\n}\n\n// this is the work we do to actually assign time to tasks\nfunction assignTimeToTasks(response, convo) {\n\n\tconst { task }                = convo;\n\tconst { bot, source_message } = task;\n\tvar { prioritizedTaskArray }  = convo.dayStart;\n\n\tvar timeToTask = response.text;\n\n\t// need to check for invalid responses.\n\t// does not say minutes or hours, or is not right length\n\tvar isInvalid = false;\n\ttimeToTask = timeToTask.split(\",\");\n\tif (timeToTask.length != prioritizedTaskArray.length) {\n\t\tisInvalid = true;\n\t};\n\n\tvar validMinutesTester = new RegExp(/[\\dh]/);\n\ttimeToTask = timeToTask.map((time) => {\n\t\tif (!validMinutesTester.test(time)) {\n\t\t\tisInvalid = true;\n\t\t}\n\t\tvar minutes = convertTimeStringToMinutes(time);\n\t\treturn minutes;\n\t});\n\n\tprioritizedTaskArray = prioritizedTaskArray.map((task, index) => {\n\t\treturn {\n\t\t\t...task,\n\t\t\tminutes: timeToTask[index]\n\t\t}\n\t});\n\n\tconvo.dayStart.prioritizedTaskArray = prioritizedTaskArray;\n\tvar taskListMessage = convertArrayToTaskListMessage(prioritizedTaskArray);\n\n\t// INVALID tester\n\tif (isInvalid) {\n\t\tconvo.say(\"Oops, looks like you didn't put in valid times :thinking_face:. Let's try this again\");\n\t\tconvo.say(\"Send me the amount of time you'd like to work on each task above, separated by commas. The first time you list will represent the first task above, the second time you list will represent the second task, and on and on\");\n\t\tconvo.say(\"I'll assume you mean minutes - like `30` would be 30 minutes - unless you specify hours - like `2 hours`\");\n\t\tconvo.say(taskListMessage);\n\t\tgetTimeToTasks(response, convo);\n\t\treturn;\n\t}\n\n\tconvo.say(\"Are these times right?\");\n\tconvo.ask(taskListMessage, [\n\t\t{\n\t\t\tpattern: bot.utterances.yes,\n\t\t\tcallback: (response, convo) => {\n\t\t\t\tconvo.say(\"Boom! This looks great\");\n\t\t\t\tconvo.ask(\"Ready to start your first focused work session today?\", [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpattern: bot.utterances.yes,\n\t\t\t\t\t\t\tcallback: (response, convo) => {\n\t\t\t\t\t\t\t\tconvo.dayStart.startDayDecision = intentConfig.START_SESSION;\n\t\t\t\t\t\t\t\tconvo.next();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpattern: bot.utterances.no,\n\t\t\t\t\t\t\tcallback: (response, convo) => {\n\t\t\t\t\t\t\t\tconvo.say(\"Great! Let me know when you're ready to start\");\n\t\t\t\t\t\t\t\tconvo.say(\"Alternatively, you can ask me to `remind` you to start at a specific time, like `remind me to start at 10am` or a relative time like `remind me in 10 minutes`\");\n\t\t\t\t\t\t\t\tconvo.next();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t], { 'key' : 'startFirstSession' })\n\t\t\t\tconvo.next();\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tpattern: bot.utterances.no,\n\t\t\tcallback: (response, convo) => {\n\t\t\t\tconvo.say(\"Let's give this another try :repeat_one:\");\n\t\t\t\tconvo.say(\"Send me the amount of time you'd like to work on each task above, separated by commas. The first time you list will represent the first task above, the second time you list will represent the second task, and on and on\");\n\t\t\t\tconvo.say(\"I'll assume you mean minutes - like `30` would be 30 minutes - unless you specify hours - like `2 hours`\");\n\t\t\t\tconvo.ask(taskListMessage, (response, convo) => {\n\t\t\t\t\tassignTimeToTasks(response, convo);\n\t\t\t\t\tconvo.next();\n\t\t\t\t})\n\t\t\t\tconvo.next();\n\t\t\t}\n\t\t}\n\t]);\n\n}\n\n"]}